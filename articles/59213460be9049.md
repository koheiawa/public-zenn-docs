---
title: "AWS Organizations の新機能 Resource Control Policies の使いどころ"
emoji: "📑"
type: "tech"
topics:
  - "aws"
  - "security"
  - "cybersecurity"
  - "pci"
published: true
published_at: "2025-01-28 17:31"
---

# マルチアカウント環境におけるAWSリソース制御ポリシーの効果的な実装方法

近年、ますます多くの企業がクラウド環境を拡大し、複数のAWSアカウントにわたる大規模な運用へと移行しています。組織が成長するにつれて、セキュリティとイノベーションのバランスを取ることが重要な課題となっています。この記事では、AWS Organizationsのリソース制御ポリシー（RCP）を活用して、複数アカウント環境でリソースへのアクセスを効果的に管理する方法について解説します。

## はじめに：大規模環境におけるクラウドセキュリティの課題

複数のAWSアカウントに数千ものリソースが分散している場合、一貫したセキュリティ管理を維持することは困難です。

AWSでは、リソースベースのポリシーを使用してきめ細かなアクセス制御を実現できますが、これらのポリシーはしばしばアプリケーション所有者に管理が委任されています。その結果、中央のセキュリティチームのような組織がすべてのリソースに対する一貫した安全な構成を確保することが難しくなっています。

## リソース制御ポリシー（RCP）とは

リソース制御ポリシー（RCP）は、AWS Organizationsの新しいタイプの承認ポリシーです。RCPはサービスコントロールポリシー（SCP）と連携して機能し、組織全体のアクセス許可に対するガードレールを確立します。SCPがIAMプリンシパルのアクションに焦点を当てているのに対し、RCPはリソースへのアクセスを制限することに焦点を当てています。

## RCP実装の5段階アプローチ

RCPを含む権限ガードレールを効果的に実装するためには、以下のようなアプローチが推奨されます：

1. セキュリティ管理の目標を検討する
2. 権限ガードレールを設計する
3. 潜在的な影響を予測する
4. 権限ガードレールを実装する
5. 権限ガードレールを監視する

それぞれのフェーズについて詳しく説明していきます。

### フェーズ1: セキュリティ管理目標の検討

RCP実装の第一歩は、組織のセキュリティ体制を強化するためにRCPがどのように役立つかを特定することです。セキュリティ制御目標は、コンプライアンス要件、法的・契約上の義務、ワークロードの種類、データの機密性レベル、脅威モデルなど様々な要因によって形作られます。

RCPは主に以下のような制御目標を達成するのに適しています：

- AWSリソースの周囲にデータ境界を確立する
- サービス間の混乱した代理リスクを軽減する
- リソースへのアクセスに一貫した制御を適用する

例えば、組織内の信頼されたIDのみがIAMロールにアクセスできるようにするという目標があるとします。小規模な組織では、各IAMロールの信頼ポリシーを個別に管理することで実現できますが、数百ものIAMロールを持つ大規模環境では、この手法は管理が困難になります。

### フェーズ2: 権限ガードレールの設計

適切なRCPを設計することで、前述のセキュリティ目標を効率的に達成できます。例えば、組織外のIDによるIAMロールへのアクセスを制限するRCPは次のようになります：

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "RestrictAccessToMyOrg",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "sts:AssumeRole",
      "Resource": "*",
      "Condition": {
        "StringNotEqualsIfExists": {
          "aws:PrincipalOrgID": "<my-org-id>"
        },
        "BoolIfExists": {
          "aws:PrincipalIsAWSService": "false"
        }
      }
    }
  ]
}
```

このポリシーは、プリンシパルが組織に属していない場合、またはAWSサービスプリンシパルでない場合にIAMロールの引き受けを拒否します。

RCPを設計する際の重要なガイドラインとして以下があります：

#### 運用効率化のための設計

- AWSアカウントの戦略的な組織化は効果的な実装の基盤となります
- AWS Organizationsで階層構造を活用し、異なるレベルでRCPを適用します
- 大規模環境では、中央セキュリティアカウントにポリシー管理を委任することを検討しましょう

#### ガバナンスの確立

- 運用モデル、変更管理プロセス、例外処理手順を含む明確なガバナンスを定義します
- RCPはSCPと類似した制御を提供するため、既存のガバナンスフレームワークと統合すべきです

#### 例外の計画

特定のケースでは、組織外のIDによるリソースへのアクセスを許可する必要があるかもしれません。例えば：

- 公開データを含むリソース
- 信頼できるパートナーとの統合

このような例外を管理するためには、次のような手法が考えられます：

1. 特定のアカウントや組織単位（OU）に別のポリシーを適用する
2. 条件キー（例：`aws:ResourceAccount`）を使用して特定のアカウントを除外する
3. リソースタグを利用して例外を管理する

例えば、タグベースの例外を実装するRCPは次のようになります：

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "RestrictAccessToMyOrgExceptTaggedRoles",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "sts:AssumeRole",
            "Resource": "*",
            "Condition": {
                "StringNotEqualsIfExists": {
                    "aws:PrincipalOrgID": "<my-org-id>",
                    "aws:ResourceTag/partner-access-exception": "trusted-partner"
                },
                "BoolIfExists": {
                    "aws:PrincipalIsAWSService": "false"
                }
            }
        },
        {
            "Sid": "RestrictAccessForTaggedRoles",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "sts:AssumeRole",
            "Resource": "*",
            "Condition": {
                "StringEquals": {
                    "aws:ResourceTag/partner-access-exception": "trusted-partner"
                },
                "StringNotEqualsIfExists": {
                    "aws:PrincipalAccount": "<trusted-partner-account-id>"
                }
            }
        }
    ]
}
```

タグベースの例外を使用する場合は、タグ自体の管理に対する厳格な制御も必要です。不正なタグ操作を防止するためのSCPを実装することを検討しましょう。

### フェーズ3: 潜在的な影響を予測する

RCPを展開する前に、その潜在的な影響を理解することが重要です。適切な検証なしに新しいポリシーを導入すると、セキュリティと事業継続性のバランスが崩れる可能性があります。

影響を評価するためのツールとして以下が有効です：

- **IAM Access Analyzer**: 外部エンティティと共有されているリソースを特定します
- **AWS CloudTrail**: アカウントアクティビティを監視し、組織外のIDによるアクセスパターンを分析します
- **Amazon Athena**: CloudTrailログをクエリして詳細な分析を行います

これらのツールを使用して、RCPの適用がビジネスワークフローに与える影響を評価し、必要に応じて例外リストやポリシーを調整できます。

### フェーズ4: 権限ガードレールの実装

実装フェーズでは、以下の要素を考慮してスムーズな展開を促進します：

#### 展開の自動化と統合

- 既存のCI/CDパイプラインを活用してRCPをデプロイします
- AWS CloudFormationの`AWS::Organizations::Policy`リソースタイプを使用してInfrastructure as Code（IaC）としてRCPを管理します
- AWS Control Towerを使用している場合は、カスタマイズソリューションを活用します

#### 段階的な導入

- まずテスト環境でRCPをテストし、影響を評価します
- 既存の制御からの移行期間中は、リソースベースのポリシーと並行してRCPを運用します
- 最も重要なリソースやアカウントから始めて、徐々に展開範囲を拡大します

### フェーズ5: 権限ガードレールの監視

最後に、実装したRCPが期待通りに機能していることを確認するための監視プロセスを確立します：

- IAM Access Analyzerの検出結果を継続的に監視します
- CloudTrailログで意図しないアクセスパターンに対するアラートを設定します
- 定期的に制御を見直し、変化するビジネスニーズやセキュリティ要件に合わせて更新します

この継続的な改善プロセスは、ビジネスの成長と変革をサポートしながら、セキュリティコントロールの有効性を維持するのに役立ちます。

## まとめ

リソース制御ポリシー（RCP）は、マルチアカウントAWS環境で大規模にリソースアクセスを管理するための強力なツールです。この記事で説明した5段階のアプローチを使用することで、ビジネスワークフローを中断するリスクを最小限に抑えながら、セキュリティ目標を達成できます。

ただし、RCPは最小権限の原則に基づく詳細なアクセス制御に取って代わるものではなく、多層的なセキュリティアプローチの一部として利用してください。RCPを適切に実装すれば、中央セキュリティチームの運用負荷を軽減しながら、開発チームがイノベーションを推進できる環境を提供します。